# RSA
## RSA public key criptography

RSA -invented in 1977 by *Ron Rivest*, *Adi Shamir* and *Leo Adleman*- is an *asymmetric* encription algorithm famous for being the first public key criptographic system capable of encoding/decoding. Although ```Diffie-Hellman (DH)``` was the first public key criptosystem -invented in 1976 by Withfield Diffie and Martin Hellman-, its goal was to exchange a key, so until the arrival of ```ElGamal``` in 1985, ```DH``` was not to capable of encode/decode information.

RSA was a different approach to solve the same problem as ```DH```: **Key distribution**. This is the main problem of *symmetric* encription algorithms, as both sides need to have the same key in order to exchange information. We will not talk of ```DH``` here, but the way RSA works is to use two keys: one for encription and one for decription. That is: what one key encripts, only the other key can decript.

Therefore, by making a key public, anybody can use it to encript data, and only the holder of the private key can decrypt it. The process also works the other way round: what is encripted with the private, can only be decripted with the public. This later approach is the basis of digital signatures and X509 certificates, as a digital signature is nothing else than the hash of certain information, encripted with a private key. Then anywone can use the public key to decript the hash, and then check it matches with the hash of the information.

This latter use of public/private keys is the actual culprit of Quantum computers being able to destroy the world of criptography. The security of RSA is based in two things: the difficulty of factorize a large *semiprime* -a number which is the product of two large primes- and the secrecy of the private key. Quantum computers can kill these two things at once by using a now infamous -but brilliant- algorithm called Shor's, which can factorize numbers extremely fast, and thus calculate a private key from its public key *very* quickly.

Oh no! ***bye bye to identity***.

I personally think that the use of RSA alone to identify things was not a good choice, as it was invented to solve a different problem: the key distribution. RSA security in this aspect -it has others in which it can still shine- did really rely in secrecy, as the factorization just helps to unveil the secret of what is the private key.

I think the identity solution actually should go along the lines of the Spanish identity cards, where your identity is public, but it identify you as you, with several biometric elements that cannot be misrepresented, as well as a digital identity that you can reset and refresh anytime if you feel it has been compromised. Anyway, that is for another day.

Here we present a library for handling RSA: Key generation, encription, decription, signatures, etc. Note that signatures are for PKCS and not PSS, but it can be easily implemented. Most of the credit should be for Simon Tatham, as this code took base on SSHRSAG.c SSHRSA.c that came with Putty v0.60, and even if it is largely changed and complemented, the core thing for key generation and encoding/decoding is still his. ;-)

## To build it:

For Microsoft C/C++ for Windows (Visual Studio C++) use:  

```
nmake /f msc.mak test
```

For Macintosh, Linux and others using GNU C:

```
make -f gcc.mak test
```
### To clean the builds:

Do the same that for build it but use *cleanit* instead of *test* as the target.

## Example output from the test program:

```

$ ./test_rsa


TEST RSA

use:	test_rsa alg [seed] [bits]

Test different RSA things using 'alg' algorithm.
'seed' is a number used to seed the algorithm. Unless is 0, which
makes the algorithm to be seeded with an umpredictable number.
'bits' is the number of bits of the primes (default 768)

Algorithms:

	1 = Mother of George Marsaglia (RAND_GM)
	2 = Mersenne Twister of Matsumoto & Nishimura (RAND_MT)
	3 = Xorshift of George Marsaglia (RAND_GX)
	4 = TLS-PRF-MD5_SHA1 (RAND_TLS_MD5_SHA1)
	5 = TLS-PRF-SHA256 (RAND_TLS_SHA256)
	6 = TLS-PRF-SHA384 (RAND_TLS_SHA384)
	7 = OSSYS of Kenneth MacKay (RAND_OS)

$ ./test_rsa 3 12345 6

===== Test RSA Key =====
Generate key using generator 'XorShift128' and seed 12345...
--- RSA KEY 1024 bits (128) ---
MOD =93BE105A1407C3C581B72E6773D04231CC7D2080EAC085B60FA0E59C1269917C4C1273613B2C8FC32166047E7B740A69ABD4A8102B150EB68DA68057FAC5A1D85219A2A355B187E1C31A760F45853AAADF2C720CC36B7E1105A8D83EE7252202A086101BB599CA4A9C929BA1557ACD2DE68EF9DCFF4332B8EB6451752F0421EB
EXP =2027
PRIV=6A5E6A62814FC4B6B11DD6840530E34D5FCFFE75230E6B270BD7C52096D9E45FC58ED2C604A89EBD80C40D6FDE96B99622037121518EE56D11AA5A59879A929FDB0DA9598DF09B7B089CBDA0D33962FCE8A3410E29B91A5AE52E110C38EFFE4F7D2316F766B9AE44D1D837101ECD4BEAFBB4A8E122BDD3B4B37A8234927E10D7
P=E92C71E6C0545BE3DFD785CAFCFDA1A0859FC0E6B6FEA82CE050F6FDFDC48674D69590569579E69121402CE30F56DAE49B8D662BAD5724887E27A5393FE5AE51
Q=A234A1A90A677E1C70026AA6B2231C6148B557B24203AAACEA63E20697DFC58EBFFBF006F0440050E87CBB88D2B2365F0DE1CC4A21CC0732A1A71E6F9636117B
-----------------------------
Verifiying key...VERIFIED

Test PKCS#1 v1.5 - Example 1
--- RSA KEY 1024 bits (128) ---
MOD =A8B3B284AF8EB50B387034A860F146C4919F318763CD6C5598C8AE4811A1E0ABC4C7E0B082D693A5E7FCED675CF4668512772C0CBC64A742C6C630F533C8CC72F62AE833C40BF25842E984BB78BDBF97C0107D55BDB662F5C4E0FAB9845CB5148EF7392DD3AAFF93AE1E6B667BB3D4247616D4F5BA10D4CFD226DE88D39F16FB
EXP =10001
PRIV=53339CFDB79FC8466A655C7316ACA85C55FD8F6DD898FDAF119517EF4F52E8FD8E258DF93FEE180FA0E4AB29693CD83B152A553D4AC4D1812B8B9FA5AF0E7F55FE7304DF41570926F3311F15C4D65A732C483116EE3D3D2D0AF3549AD9BF7CBFB78AD884F84D5BEB04724DC7369B31DEF37D0CF539E9CFCDD3DE653729EAD5D1
P=NULL
Q=NULL
-----------------------------
TXT =52e650d98e7f2a048b4f86852153b97e01dd316f346a19f67a85
Encoding with Public Key...
RSA =54ddb784268eadb3955bd9f9498842595ad29ff8a667feb41f6f530cb60bc926ac6c71c772f803d022b41ca57204223b27ca79ec5b72652ca9afbf40dc2f6a0e13bcd60d37f79504b0ffcc01cf5342d6d34ac6f1f2f9f2f4874625b9fdbb7dda2ec87df0cf87259798df86a06bd5aef7354b8cb1cb137575f4cfbc46281bb331
ENC =54ddb784268eadb3955bd9f9498842595ad29ff8a667feb41f6f530cb60bc926ac6c71c772f803d022b41ca57204223b27ca79ec5b72652ca9afbf40dc2f6a0e13bcd60d37f79504b0ffcc01cf5342d6d34ac6f1f2f9f2f4874625b9fdbb7dda2ec87df0cf87259798df86a06bd5aef7354b8cb1cb137575f4cfbc46281bb331
memcmp(128,128) = CORRECT
Decoding with Private Key...
STR =52e650d98e7f2a048b4f86852153b97e01dd316f346a19f67a85
TXT =52e650d98e7f2a048b4f86852153b97e01dd316f346a19f67a85

Test PKCS#1 v1.5 - Example 14.2
--- RSA KEY 1536 bits (192) ---
MOD =BE0CA01F9C172166F912391E5D58DDC30D5DD0279A49BB312A31E4C8A66A52FB4E8B6742FAACB224C3039F1E198F3323B888BA0E35BB94C511BD22B886405A715E409DE3BCEB4FC9911B0E9C3B1E42E257D5BBEA0722B5D5DD3537569DC7560646A750B87EAA6F3A405A94BF2ADA72B50A4B0187BB9D00EC451D50A6A91A1E2A91192A7FD756B900141FE88F96E2080DFDD80166A7BF67E37144D09E3AF89974E57C72B03A2B88FD2995252ACE4F30E2E47C2818057240536B58DB4207509E59
EXP =10001
PRIV=F37D28D61F2899A5C0E0A0749D1389387C64C8C358A971DAD13CFF85C59A62DDA7BBC0F7E5BDC65DFF9DE9C745404631758148168DFE6AC0A2876A56053BAB2A2A9FF272794DD5D8139EED10BCFB4DF33020D59E3048FD2F0C431426145E36A1D0A6BFCE4443EF3C7E31D4A92FB8517A49F788C3B4E137395A4BEEEA63E0E0ADC3224F980925037DF6F5B26C007239B4F01F8A9A61EA0B5119BC9D5496A95B60EA766CCBADE037E340324F25F02E7245C236EAE4367A6468A7A0938D85C0A1
P=NULL
Q=NULL
-----------------------------
TXT =104735d9ad726046473df4b13b2f5fa285c3d233ecd46170582dd228cdee464da5095e208cf8fbca05388b
Encoding with Public Key...
RSA =921d2b026d6b7e22201de77fbf679990f9aff4ea7fe7ce4502215f9e7aa418b85f72eadb6b6942bb08a08be7da6619aa5f1d2ff961c9dc2c341ae32a254fdeaba2f6450ac4474b6274f0c346f26da4ed555a8c951189dc8369f34d76d837d6f38a9518a6271c5b56346225a5ab8da6032a5930fd5b77729de632e1752fc72a0c34aece25657b281be8932c5650c982fa145fde0bcdd48a73aa0288b4de461133f27d51e386016a72726a9ede1d32dfc7e6f9780c04eb70ffffc2688295667333
ENC =921d2b026d6b7e22201de77fbf679990f9aff4ea7fe7ce4502215f9e7aa418b85f72eadb6b6942bb08a08be7da6619aa5f1d2ff961c9dc2c341ae32a254fdeaba2f6450ac4474b6274f0c346f26da4ed555a8c951189dc8369f34d76d837d6f38a9518a6271c5b56346225a5ab8da6032a5930fd5b77729de632e1752fc72a0c34aece25657b281be8932c5650c982fa145fde0bcdd48a73aa0288b4de461133f27d51e386016a72726a9ede1d32dfc7e6f9780c04eb70ffffc2688295667333
memcmp(192,192) = CORRECT
Decoding with Private Key...
STR =104735d9ad726046473df4b13b2f5fa285c3d233ecd46170582dd228cdee464da5095e208cf8fbca05388b
TXT =104735d9ad726046473df4b13b2f5fa285c3d233ecd46170582dd228cdee464da5095e208cf8fbca05388b

Test PKCS#1 v1.5 - Example 15.1
--- RSA KEY 2048 bits (256) ---
MOD =DCFA10FFA74665AEEF870974EA99B2CE54547C67F42AAA6DD01A2ED31FD2C242AF5D960B1F896EFBA3543D6554B7B12687A5C688568F32E026C532D25993B97A7C2842EC2B8E1235EEE2414D25806C6FBAE438954EBA9D2755DFFEEB1B47700957815A8A233F97B1A2C714B3E2BE2E42D8BE30B1961582EA9948910E0C797C50FC4BB455F0FC45E5E34E6396AC5B2D46239365C7F3DAAF0909400D61CF9E0CA8083EAF335A6FCEB6863C1CC0CF5A171AFF35D97ECB60EF251C7EC2C8A588361DC41266A4B7ED38B026CE0D53786449DBB11A06EA33CCF1ECA575201ED1AA473ED1187EC1D8A744EA345BED7EA00EE4E81BBA4648601DD537DC91015D31F0C2C1
EXP =10001
PRIV=21950851CDF25320318B305AFA0F371F07AE5A44B314EBD729F5DCB15DA7FA3947ACDD915DAED574BD16DF88BF85F61060B387172FAE6E01262B3864C2D3C22F94E04A8159422B4ED279C48A4C9D767D4966071A5BBF5D043E16FF46EC1BA0716F00BBC97BFF5D5693E214E99C9721F12B3EC6282AE2A485721B96DDCF7403FA037D0C57AB463C448DE5CC12265ADD886D311EA8D8A5903FA56C5F1C9CF2EB11CB657A1A7D3E41352DC3E686898C4CE4305E8B638E1B08A2A86CC9EB9866F3499AC77B6136B81CB276D614CFEB7B6ED3F3BC775E46C00066EBEEE2CFF7166B57520598947FF6210320B288FB4F2C3F8FE97B279414EBF7203000A19FC0424875
P=NULL
Q=NULL
-----------------------------
TXT =2aacec86f423dd925ec158822a748cbe6c31a0
Encoding with Public Key...
RSA =6042e745589af03af87520f93c45d8c35985ada1161a37d822e9f9460fc75fcf0179d8491b8f5d1e4de8ceb31e07c4865c5a3efdbbb69a8803b89ee65a430a5809c707569150b580bb686a94c5541c46adcd827960ce244ff688387d1616e85b4d1780c6483606cf924b54f080cf4154e66829bf6e532481048ec41fadc07d755bb34bb28145219cb30d47d0d618709180e90303ff9ef09018bed3da75761da794811f96bc9e8d7c4ba1b5946bda0bd313faec4c993ed2748eed8cce4bdb520ba7db165f9fe56aa8454d6ff33874feeebf29de2df5b7f00aa1d9fb073fc4067b58dc50624e127f711dde2cc2cfdab4919ccf28c83660dfc227b0f500ec1f904f
ENC =6042e745589af03af87520f93c45d8c35985ada1161a37d822e9f9460fc75fcf0179d8491b8f5d1e4de8ceb31e07c4865c5a3efdbbb69a8803b89ee65a430a5809c707569150b580bb686a94c5541c46adcd827960ce244ff688387d1616e85b4d1780c6483606cf924b54f080cf4154e66829bf6e532481048ec41fadc07d755bb34bb28145219cb30d47d0d618709180e90303ff9ef09018bed3da75761da794811f96bc9e8d7c4ba1b5946bda0bd313faec4c993ed2748eed8cce4bdb520ba7db165f9fe56aa8454d6ff33874feeebf29de2df5b7f00aa1d9fb073fc4067b58dc50624e127f711dde2cc2cfdab4919ccf28c83660dfc227b0f500ec1f904f
memcmp(256,256) = CORRECT
Decoding with Private Key...
STR =2aacec86f423dd925ec158822a748cbe6c31a0
TXT =2aacec86f423dd925ec158822a748cbe6c31a0

===== Test RSA signature =====
Test with Key 1
TXT =45766572796f6e65206765747320467269646179206f66662e
SIGN=05fa6a812fc7df8bf4f2542509e03e846e11b9c620be2009efb440efbcc669216994ac04f341b57d05202d428fb2a27b5c77dfd9b15bfc3d559353503410c1e1
RES =0238a9d70c1d4c2eab196ad1f62dadb4c52d6aeff0b42336e75685c0604edb9f22899c6f1d0612b58e5267a42732466e36e950f47e69733f45b802653d8b1055
Result is inorrect

Test with Key 2
TXT =74657374
SIGN=a7e00ce4391f914d82158d9b732759808e25a1c6383fe87a5199157650d4296cf612e9ff809e686a0af328238306e79965f6d0138138829d9a1a22764306f6ce
RES =a7e00ce4391f914d82158d9b732759808e25a1c6383fe87a5199157650d4296cf612e9ff809e686a0af328238306e79965f6d0138138829d9a1a22764306f6ce
Result is correct
                     
```




